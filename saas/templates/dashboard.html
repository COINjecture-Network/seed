<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GoldenSeed Compression SaaS</title>
    <style>
        :root {
            --gold: #c9a227;
            --gold-light: #e8d48b;
            --dark: #0d1117;
            --dark-card: #161b22;
            --dark-border: #30363d;
            --text: #e6edf3;
            --text-muted: #8b949e;
            --green: #3fb950;
            --blue: #58a6ff;
            --red: #f85149;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: var(--dark);
            color: var(--text);
            line-height: 1.6;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 24px; }

        /* Header */
        header {
            border-bottom: 1px solid var(--dark-border);
            padding: 16px 0;
        }
        header .container {
            display: flex; align-items: center; justify-content: space-between;
        }
        .logo {
            font-size: 1.4rem; font-weight: 700; color: var(--gold);
            text-decoration: none;
        }
        .logo span { color: var(--text); font-weight: 400; }
        nav a {
            color: var(--text-muted); text-decoration: none; margin-left: 24px;
            font-size: 0.9rem; transition: color 0.2s;
        }
        nav a:hover { color: var(--text); }
        #auth-nav { display: none; }

        /* Hero */
        .hero {
            text-align: center; padding: 80px 0 60px;
            background: linear-gradient(180deg, rgba(201,162,39,0.06) 0%, transparent 100%);
        }
        .hero h1 { font-size: 2.8rem; margin-bottom: 16px; }
        .hero h1 em { color: var(--gold); font-style: normal; }
        .hero p { color: var(--text-muted); font-size: 1.15rem; max-width: 640px; margin: 0 auto 32px; }
        .hero-stats {
            display: flex; gap: 48px; justify-content: center; margin-top: 40px;
        }
        .hero-stats .stat { text-align: center; }
        .hero-stats .stat-value {
            font-size: 2rem; font-weight: 700; color: var(--gold);
        }
        .hero-stats .stat-label { color: var(--text-muted); font-size: 0.85rem; }

        /* Cards */
        .card-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            gap: 24px; padding: 40px 0;
        }
        .card {
            background: var(--dark-card); border: 1px solid var(--dark-border);
            border-radius: 12px; padding: 28px; transition: border-color 0.2s;
        }
        .card:hover { border-color: var(--gold); }
        .card h3 { color: var(--gold); margin-bottom: 8px; font-size: 1.1rem; }
        .card p { color: var(--text-muted); font-size: 0.9rem; }

        /* Auth Forms */
        .auth-section {
            max-width: 440px; margin: 40px auto; padding: 32px;
            background: var(--dark-card); border: 1px solid var(--dark-border);
            border-radius: 12px; display: none;
        }
        .auth-section.active { display: block; }
        .auth-section h2 { margin-bottom: 20px; }
        .form-group { margin-bottom: 16px; }
        .form-group label {
            display: block; margin-bottom: 4px; color: var(--text-muted);
            font-size: 0.85rem;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%; padding: 10px 12px; background: var(--dark);
            border: 1px solid var(--dark-border); border-radius: 6px;
            color: var(--text); font-size: 0.95rem; font-family: inherit;
        }
        .form-group input:focus, .form-group textarea:focus {
            outline: none; border-color: var(--gold);
        }
        .btn {
            padding: 10px 20px; border-radius: 6px; border: none; cursor: pointer;
            font-size: 0.95rem; font-weight: 600; transition: all 0.2s;
        }
        .btn-primary {
            background: var(--gold); color: var(--dark); width: 100%;
        }
        .btn-primary:hover { background: var(--gold-light); }
        .btn-secondary {
            background: transparent; color: var(--text); border: 1px solid var(--dark-border);
        }
        .btn-sm { padding: 6px 14px; font-size: 0.85rem; }
        .link-btn {
            background: none; border: none; color: var(--blue); cursor: pointer;
            font-size: 0.9rem; padding: 0; margin-top: 12px; display: inline-block;
        }

        /* Dashboard */
        #dashboard { display: none; padding: 40px 0; }
        .dash-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 32px;
        }
        .dash-header h2 { font-size: 1.6rem; }
        .tier-badge {
            padding: 4px 12px; border-radius: 20px; font-size: 0.8rem;
            font-weight: 600; text-transform: uppercase;
        }
        .tier-free { background: var(--dark-border); color: var(--text-muted); }
        .tier-pro { background: rgba(201,162,39,0.2); color: var(--gold); }
        .tier-enterprise { background: rgba(63,185,80,0.2); color: var(--green); }

        /* Compression Tool */
        .tool-section {
            background: var(--dark-card); border: 1px solid var(--dark-border);
            border-radius: 12px; padding: 28px; margin-bottom: 24px;
        }
        .tool-section h3 { margin-bottom: 16px; color: var(--gold); }
        .tool-tabs {
            display: flex; gap: 8px; margin-bottom: 20px;
        }
        .tool-tab {
            padding: 8px 16px; border-radius: 6px; border: 1px solid var(--dark-border);
            background: transparent; color: var(--text-muted); cursor: pointer;
            font-size: 0.85rem;
        }
        .tool-tab.active {
            background: var(--gold); color: var(--dark); border-color: var(--gold);
        }
        .result-box {
            background: var(--dark); border: 1px solid var(--dark-border);
            border-radius: 8px; padding: 16px; margin-top: 16px;
            font-family: 'SF Mono', Monaco, monospace; font-size: 0.85rem;
            white-space: pre-wrap; word-break: break-all; max-height: 300px;
            overflow-y: auto; display: none;
        }
        .result-box.visible { display: block; }
        .stats-row {
            display: flex; gap: 24px; margin-top: 16px; flex-wrap: wrap;
        }
        .stat-chip {
            background: var(--dark); padding: 8px 16px; border-radius: 6px;
            font-size: 0.85rem;
        }
        .stat-chip strong { color: var(--gold); }

        /* Usage */
        .usage-bar-container {
            background: var(--dark); border-radius: 8px; height: 12px;
            margin: 8px 0; overflow: hidden;
        }
        .usage-bar {
            height: 100%; background: var(--gold); border-radius: 8px;
            transition: width 0.3s;
        }

        /* API Key display */
        .api-key-box {
            background: var(--dark); padding: 12px; border-radius: 6px;
            font-family: monospace; font-size: 0.9rem; margin: 8px 0;
            border: 1px solid var(--gold); word-break: break-all;
        }

        /* Code example */
        .code-block {
            background: var(--dark); border: 1px solid var(--dark-border);
            border-radius: 8px; padding: 20px; margin: 16px 0;
            font-family: 'SF Mono', Monaco, monospace; font-size: 0.85rem;
            overflow-x: auto; line-height: 1.5;
        }
        .code-block .comment { color: var(--text-muted); }
        .code-block .keyword { color: var(--blue); }
        .code-block .string { color: var(--green); }
        .code-block .func { color: var(--gold); }

        /* Pricing */
        .pricing-grid {
            display: grid; grid-template-columns: repeat(3, 1fr);
            gap: 24px; padding: 40px 0;
        }
        .price-card {
            background: var(--dark-card); border: 1px solid var(--dark-border);
            border-radius: 12px; padding: 32px; text-align: center;
        }
        .price-card.featured { border-color: var(--gold); }
        .price-card h3 { color: var(--gold); margin-bottom: 8px; }
        .price-amount {
            font-size: 2.4rem; font-weight: 700; margin: 16px 0 8px;
        }
        .price-amount span { font-size: 1rem; color: var(--text-muted); }
        .price-features { list-style: none; margin: 24px 0; text-align: left; }
        .price-features li {
            padding: 8px 0; border-bottom: 1px solid var(--dark-border);
            font-size: 0.9rem; color: var(--text-muted);
        }
        .price-features li::before { content: "-> "; color: var(--gold); }

        .alert {
            padding: 12px 16px; border-radius: 6px; margin: 12px 0;
            font-size: 0.9rem; display: none;
        }
        .alert-success { background: rgba(63,185,80,0.15); color: var(--green); display: block; }
        .alert-error { background: rgba(248,81,73,0.15); color: var(--red); display: block; }

        footer {
            border-top: 1px solid var(--dark-border); padding: 24px 0;
            text-align: center; color: var(--text-muted); font-size: 0.85rem;
            margin-top: 60px;
        }

        @media (max-width: 768px) {
            .hero h1 { font-size: 1.8rem; }
            .hero-stats { flex-direction: column; gap: 16px; }
            .pricing-grid { grid-template-columns: 1fr; }
            .card-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<header>
    <div class="container">
        <a href="/" class="logo">GoldenSeed <span>Compression</span></a>
        <nav>
            <a href="#features">Features</a>
            <a href="#pricing">Pricing</a>
            <a href="/api/docs" target="_blank">API Docs</a>
            <a href="#" id="login-link" onclick="showAuth('login')">Login</a>
            <a href="#" id="signup-link" onclick="showAuth('register')">Sign Up</a>
            <span id="auth-nav">
                <a href="#" onclick="showDashboard()">Dashboard</a>
                <a href="#" onclick="logout()">Logout</a>
            </span>
        </nav>
    </div>
</header>

<!-- Hero -->
<section class="hero" id="hero-section">
    <div class="container">
        <h1>Compress Data with <em>Seeds</em></h1>
        <p>
            Universal encoding and decoding that replaces bandwidth with mathematics.
            Transmit a 60-byte seed envelope instead of gigabytes of data.
            Recipients regenerate identical data locally.
        </p>
        <div class="hero-stats">
            <div class="stat">
                <div class="stat-value">33M:1</div>
                <div class="stat-label">Max Compression Ratio</div>
            </div>
            <div class="stat">
                <div class="stat-value">60 bytes</div>
                <div class="stat-label">Envelope Size (1GB ref)</div>
            </div>
            <div class="stat">
                <div class="stat-value">0 bytes</div>
                <div class="stat-label">Bandwidth for Stream Data</div>
            </div>
        </div>
    </div>
</section>

<!-- Features -->
<section id="features">
    <div class="container">
        <div class="card-grid">
            <div class="card">
                <h3>Stream Compression</h3>
                <p>Reference any segment of the deterministic stream. A 1GB segment compresses to ~60 bytes. The recipient regenerates it locally from the seed.</p>
            </div>
            <div class="card">
                <h3>Delta Encoding</h3>
                <p>For arbitrary data, XOR against the deterministic stream and store only the difference. Combined with zlib, achieves high compression on patterned data.</p>
            </div>
            <div class="card">
                <h3>Universal Decoding</h3>
                <p>Any language, any platform. The same seed produces byte-for-byte identical output in Python, Rust, Go, C, C++, Java, JavaScript, and TypeScript.</p>
            </div>
            <div class="card">
                <h3>Zero Dependencies</h3>
                <p>Built on pure mathematics - SHA-256 and the Golden Ratio. No proprietary codecs, no special libraries. Just math.</p>
            </div>
            <div class="card">
                <h3>REST API</h3>
                <p>Simple REST API with JWT and API key authentication. Encode, decode, and manage seed envelopes programmatically.</p>
            </div>
            <div class="card">
                <h3>Catalog System</h3>
                <p>Register known datasets by name. Share catalogs between parties for true zero-bandwidth data distribution.</p>
            </div>
        </div>
    </div>
</section>

<!-- Auth Forms -->
<div class="auth-section" id="register-form">
    <h2>Create Account</h2>
    <div id="register-alert"></div>
    <div class="form-group">
        <label>Email</label>
        <input type="email" id="reg-email" placeholder="you@example.com">
    </div>
    <div class="form-group">
        <label>Name</label>
        <input type="text" id="reg-name" placeholder="Your name">
    </div>
    <div class="form-group">
        <label>Password</label>
        <input type="password" id="reg-password" placeholder="Min 8 characters">
    </div>
    <button class="btn btn-primary" onclick="register()">Create Account</button>
    <button class="link-btn" onclick="showAuth('login')">Already have an account? Login</button>
</div>

<div class="auth-section" id="login-form">
    <h2>Login</h2>
    <div id="login-alert"></div>
    <div class="form-group">
        <label>Email</label>
        <input type="email" id="login-email" placeholder="you@example.com">
    </div>
    <div class="form-group">
        <label>Password</label>
        <input type="password" id="login-password" placeholder="Password">
    </div>
    <button class="btn btn-primary" onclick="login()">Login</button>
    <button class="link-btn" onclick="showAuth('register')">Need an account? Sign up</button>
</div>

<!-- Dashboard -->
<div id="dashboard">
    <div class="container">
        <div class="dash-header">
            <h2>Dashboard</h2>
            <span class="tier-badge tier-free" id="tier-badge">FREE</span>
        </div>

        <!-- API Key Section -->
        <div class="tool-section" id="api-key-section" style="display:none;">
            <h3>Your API Key</h3>
            <p style="color:var(--text-muted);font-size:0.9rem;margin-bottom:8px;">
                Save this key now - it won't be shown again.
            </p>
            <div class="api-key-box" id="api-key-display"></div>
        </div>

        <!-- Compression Tool -->
        <div class="tool-section">
            <h3>Compression Tool</h3>
            <div class="tool-tabs">
                <button class="tool-tab active" onclick="switchTab('encode')">Encode</button>
                <button class="tool-tab" onclick="switchTab('decode')">Decode</button>
                <button class="tool-tab" onclick="switchTab('stream')">Stream Ref</button>
            </div>

            <!-- Encode Tab -->
            <div id="tab-encode">
                <div class="form-group">
                    <label>Data (paste text or drag a file)</label>
                    <textarea id="encode-input" rows="5" placeholder="Enter data to compress..."></textarea>
                </div>
                <div class="form-group">
                    <label>Seed</label>
                    <select id="encode-seed">
                        <option value="golden_ratio">Golden Ratio (default)</option>
                        <option value="pi">Pi</option>
                        <option value="e">Euler's Number</option>
                        <option value="sqrt2">Square Root of 2</option>
                    </select>
                </div>
                <button class="btn btn-primary" onclick="encodeData()">Encode & Compress</button>
                <div id="encode-result" class="result-box"></div>
                <div id="encode-stats" class="stats-row"></div>
            </div>

            <!-- Decode Tab -->
            <div id="tab-decode" style="display:none;">
                <div class="form-group">
                    <label>Envelope JSON</label>
                    <textarea id="decode-input" rows="6" placeholder='Paste envelope JSON or enter an envelope ID...'></textarea>
                </div>
                <button class="btn btn-primary" onclick="decodeData()">Decode & Decompress</button>
                <div id="decode-result" class="result-box"></div>
            </div>

            <!-- Stream Ref Tab -->
            <div id="tab-stream" style="display:none;">
                <div class="form-group">
                    <label>Seed</label>
                    <select id="stream-seed">
                        <option value="golden_ratio">Golden Ratio</option>
                        <option value="pi">Pi</option>
                        <option value="e">Euler's Number</option>
                        <option value="sqrt2">Square Root of 2</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Offset (bytes)</label>
                    <input type="number" id="stream-offset" value="0" min="0">
                </div>
                <div class="form-group">
                    <label>Length (bytes)</label>
                    <input type="number" id="stream-length" value="1048576" min="1">
                </div>
                <button class="btn btn-primary" onclick="createStreamRef()">Create Stream Reference</button>
                <div id="stream-result" class="result-box"></div>
                <div id="stream-stats" class="stats-row"></div>
            </div>
        </div>

        <!-- Usage Stats -->
        <div class="tool-section">
            <h3>Usage This Month</h3>
            <div id="usage-stats">
                <p style="color:var(--text-muted);">Loading...</p>
            </div>
        </div>

        <!-- Stored Envelopes -->
        <div class="tool-section">
            <h3>Stored Envelopes</h3>
            <div id="envelopes-list">
                <p style="color:var(--text-muted);">Loading...</p>
            </div>
        </div>

        <!-- Quick Start Code -->
        <div class="tool-section">
            <h3>Quick Start</h3>
            <div class="code-block">
<span class="comment"># Install</span>
pip install golden-seed

<span class="comment"># Python SDK</span>
<span class="keyword">from</span> gq.codec <span class="keyword">import</span> encode, decode

data = <span class="string">b"Hello, World!" * 1000</span>
envelope = <span class="func">encode</span>(data)
<span class="func">print</span>(f<span class="string">"Compressed {len(data)} bytes -> {envelope.envelope_size} byte envelope"</span>)

restored = <span class="func">decode</span>(envelope)
<span class="keyword">assert</span> restored == data  <span class="comment"># Byte-perfect reconstruction</span>

<span class="comment"># REST API</span>
curl -X POST https://your-host/api/v1/encode \
  -H <span class="string">"X-API-Key: gseed_your_key_here"</span> \
  -H <span class="string">"Content-Type: application/json"</span> \
  -d <span class="string">'{"data_base64": "SGVsbG8gV29ybGQ=", "seed_id": "golden_ratio"}'</span>
            </div>
        </div>
    </div>
</div>

<!-- Pricing -->
<section id="pricing">
    <div class="container">
        <h2 style="text-align:center;margin-bottom:8px;font-size:1.8rem;">Pricing</h2>
        <p style="text-align:center;color:var(--text-muted);margin-bottom:24px;">
            Start free. Scale as you grow.
        </p>
        <div class="pricing-grid">
            <div class="price-card">
                <h3>Free</h3>
                <div class="price-amount">$0<span>/mo</span></div>
                <ul class="price-features">
                    <li>1,000 requests/month</li>
                    <li>100 MB data/month</li>
                    <li>All compression modes</li>
                    <li>API key access</li>
                    <li>Community support</li>
                </ul>
                <button class="btn btn-secondary" onclick="showAuth('register')" style="width:100%">Get Started</button>
            </div>
            <div class="price-card featured">
                <h3>Pro</h3>
                <div class="price-amount">$29<span>/mo</span></div>
                <ul class="price-features">
                    <li>100,000 requests/month</li>
                    <li>10 GB data/month</li>
                    <li>All compression modes</li>
                    <li>Priority API access</li>
                    <li>Email support</li>
                </ul>
                <button class="btn btn-primary" onclick="showAuth('register')" style="width:100%">Start Pro</button>
            </div>
            <div class="price-card">
                <h3>Enterprise</h3>
                <div class="price-amount">Custom</div>
                <ul class="price-features">
                    <li>Unlimited requests</li>
                    <li>Unlimited data</li>
                    <li>Custom seed catalogs</li>
                    <li>On-premise deployment</li>
                    <li>Dedicated support</li>
                </ul>
                <button class="btn btn-secondary" style="width:100%">Contact Us</button>
            </div>
        </div>
    </div>
</section>

<footer>
    <div class="container">
        GoldenSeed Compression SaaS &mdash; Built on deterministic mathematics, not bandwidth.
    </div>
</footer>

<script>
const API = '/api/v1';
let token = localStorage.getItem('gs_token');
let apiKey = null;

// State
function headers() {
    const h = {'Content-Type': 'application/json'};
    if (token) h['Authorization'] = 'Bearer ' + token;
    return h;
}

async function api(method, path, body) {
    const opts = {method, headers: headers()};
    if (body) opts.body = JSON.stringify(body);
    const res = await fetch(API + path, opts);
    const data = await res.json();
    if (!res.ok) throw new Error(data.detail || 'Request failed');
    return data;
}

// Auth
function showAuth(type) {
    document.getElementById('register-form').classList.toggle('active', type === 'register');
    document.getElementById('login-form').classList.toggle('active', type === 'login');
    document.getElementById('dashboard').style.display = 'none';
}

async function register() {
    const alertEl = document.getElementById('register-alert');
    try {
        const data = await api('POST', '/auth/register', {
            email: document.getElementById('reg-email').value,
            password: document.getElementById('reg-password').value,
            name: document.getElementById('reg-name').value,
        });
        token = data.token;
        localStorage.setItem('gs_token', token);
        apiKey = data.api_key;
        alertEl.className = 'alert alert-success';
        alertEl.textContent = 'Account created!';
        showDashboard();
        if (apiKey) {
            document.getElementById('api-key-section').style.display = 'block';
            document.getElementById('api-key-display').textContent = apiKey;
        }
    } catch(e) {
        alertEl.className = 'alert alert-error';
        alertEl.textContent = e.message;
    }
}

async function login() {
    const alertEl = document.getElementById('login-alert');
    try {
        const data = await api('POST', '/auth/login', {
            email: document.getElementById('login-email').value,
            password: document.getElementById('login-password').value,
        });
        token = data.token;
        localStorage.setItem('gs_token', token);
        alertEl.className = 'alert alert-success';
        alertEl.textContent = 'Logged in!';
        showDashboard();
    } catch(e) {
        alertEl.className = 'alert alert-error';
        alertEl.textContent = e.message;
    }
}

function logout() {
    token = null;
    localStorage.removeItem('gs_token');
    document.getElementById('dashboard').style.display = 'none';
    document.getElementById('auth-nav').style.display = 'none';
    document.getElementById('login-link').style.display = '';
    document.getElementById('signup-link').style.display = '';
    document.getElementById('hero-section').style.display = '';
    document.getElementById('features').style.display = '';
    document.getElementById('pricing').style.display = '';
}

async function showDashboard() {
    document.getElementById('register-form').classList.remove('active');
    document.getElementById('login-form').classList.remove('active');
    document.getElementById('dashboard').style.display = 'block';
    document.getElementById('auth-nav').style.display = 'inline';
    document.getElementById('login-link').style.display = 'none';
    document.getElementById('signup-link').style.display = 'none';
    document.getElementById('hero-section').style.display = 'none';
    document.getElementById('features').style.display = 'none';
    document.getElementById('pricing').style.display = 'none';
    loadUsage();
    loadEnvelopes();
}

// Tabs
function switchTab(name) {
    ['encode','decode','stream'].forEach(t => {
        document.getElementById('tab-'+t).style.display = t===name?'block':'none';
    });
    document.querySelectorAll('.tool-tab').forEach((el,i) => {
        el.classList.toggle('active', el.textContent.toLowerCase().replace(' ref','') === name);
    });
}

// Encode
async function encodeData() {
    const input = document.getElementById('encode-input').value;
    const seed = document.getElementById('encode-seed').value;
    const resultEl = document.getElementById('encode-result');
    const statsEl = document.getElementById('encode-stats');
    try {
        const b64 = btoa(unescape(encodeURIComponent(input)));
        const data = await api('POST', '/encode', {data_base64: b64, seed_id: seed});
        resultEl.textContent = JSON.stringify(data.envelope, null, 2);
        resultEl.classList.add('visible');
        const s = data.stats;
        statsEl.innerHTML = `
            <div class="stat-chip"><strong>${s.compression_ratio}:1</strong> ratio</div>
            <div class="stat-chip"><strong>${s.original_size_bytes}</strong> bytes in</div>
            <div class="stat-chip"><strong>${s.envelope_size_bytes}</strong> bytes out</div>
            <div class="stat-chip"><strong>${s.space_savings_percent}%</strong> saved</div>
            <div class="stat-chip">mode: <strong>${s.mode}</strong></div>
        `;
    } catch(e) {
        resultEl.textContent = 'Error: ' + e.message;
        resultEl.classList.add('visible');
    }
}

// Decode
async function decodeData() {
    const input = document.getElementById('decode-input').value.trim();
    const resultEl = document.getElementById('decode-result');
    try {
        let body;
        if (input.startsWith('{')) {
            body = {envelope: JSON.parse(input)};
        } else {
            body = {envelope_id: input};
        }
        const data = await api('POST', '/decode', body);
        const decoded = decodeURIComponent(escape(atob(data.data_base64)));
        resultEl.textContent = decoded;
        resultEl.classList.add('visible');
    } catch(e) {
        resultEl.textContent = 'Error: ' + e.message;
        resultEl.classList.add('visible');
    }
}

// Stream Reference
async function createStreamRef() {
    const seed = document.getElementById('stream-seed').value;
    const offset = parseInt(document.getElementById('stream-offset').value);
    const length = parseInt(document.getElementById('stream-length').value);
    const resultEl = document.getElementById('stream-result');
    const statsEl = document.getElementById('stream-stats');
    try {
        const data = await api('POST', '/stream', {seed_id: seed, offset, length});
        resultEl.textContent = JSON.stringify(data.envelope, null, 2);
        resultEl.classList.add('visible');
        const s = data.stats;
        statsEl.innerHTML = `
            <div class="stat-chip"><strong>${s.compression_ratio}:1</strong> ratio</div>
            <div class="stat-chip"><strong>${formatBytes(s.original_size_bytes)}</strong> referenced</div>
            <div class="stat-chip"><strong>${s.envelope_size_bytes}</strong> bytes envelope</div>
        `;
    } catch(e) {
        resultEl.textContent = 'Error: ' + e.message;
        resultEl.classList.add('visible');
    }
}

// Usage
async function loadUsage() {
    try {
        const data = await api('GET', '/usage');
        const u = data.usage;
        const t = data.tier;
        document.getElementById('tier-badge').textContent = t.tier.toUpperCase();
        document.getElementById('tier-badge').className = 'tier-badge tier-' + t.tier;
        const pctReq = t.requests_limit > 0 ? Math.min(100, (t.requests_used/t.requests_limit)*100) : 0;
        const pctBytes = t.bytes_limit > 0 ? Math.min(100, (t.bytes_used/t.bytes_limit)*100) : 0;
        document.getElementById('usage-stats').innerHTML = `
            <p style="margin-bottom:4px;">Requests: ${t.requests_used} / ${t.requests_limit === -1 ? 'Unlimited' : t.requests_limit}</p>
            <div class="usage-bar-container"><div class="usage-bar" style="width:${pctReq}%"></div></div>
            <p style="margin-bottom:4px;margin-top:12px;">Data: ${formatBytes(t.bytes_used)} / ${t.bytes_limit === -1 ? 'Unlimited' : formatBytes(t.bytes_limit)}</p>
            <div class="usage-bar-container"><div class="usage-bar" style="width:${pctBytes}%"></div></div>
            <p style="margin-top:12px;color:var(--text-muted);font-size:0.85rem;">Avg compression ratio: <strong style="color:var(--gold);">${(u.avg_compression_ratio||0).toFixed(1)}:1</strong></p>
        `;
    } catch(e) {
        document.getElementById('usage-stats').innerHTML = '<p style="color:var(--red);">Failed to load usage</p>';
    }
}

// Envelopes
async function loadEnvelopes() {
    try {
        const data = await api('GET', '/envelopes');
        if (data.envelopes.length === 0) {
            document.getElementById('envelopes-list').innerHTML = '<p style="color:var(--text-muted);">No envelopes yet. Encode some data to get started.</p>';
            return;
        }
        let html = '<table style="width:100%;font-size:0.85rem;"><tr style="color:var(--text-muted);text-align:left;"><th>ID</th><th>Mode</th><th>Original</th><th>Envelope</th><th>Ratio</th><th>Created</th></tr>';
        data.envelopes.forEach(e => {
            const ratio = e.envelope_size > 0 ? (e.original_size / e.envelope_size).toFixed(1) : '-';
            const date = new Date(e.created_at * 1000).toLocaleDateString();
            html += `<tr><td style="font-family:monospace;color:var(--blue);">${e.envelope_id.slice(0,12)}...</td><td>${e.mode}</td><td>${formatBytes(e.original_size)}</td><td>${formatBytes(e.envelope_size)}</td><td style="color:var(--gold);">${ratio}:1</td><td style="color:var(--text-muted);">${date}</td></tr>`;
        });
        html += '</table>';
        document.getElementById('envelopes-list').innerHTML = html;
    } catch(e) {
        document.getElementById('envelopes-list').innerHTML = '<p style="color:var(--red);">Failed to load envelopes</p>';
    }
}

function formatBytes(bytes) {
    if (bytes === 0) return '0 B';
    const k = 1024;
    const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return parseFloat((bytes / Math.pow(k, i)).toFixed(1)) + ' ' + sizes[i];
}

// Init
if (token) {
    showDashboard();
}
</script>

</body>
</html>
